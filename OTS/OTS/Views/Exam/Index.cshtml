@model OTS.Model.Student
@{
	Layout = null;
}

<!DOCTYPE html>
<html lang="en">
<head>
	<style type="text/css">
		.center {
			text-align: center;
		}

		.outer-container {
			position: absolute;
			display: table;
			width: 100%; /* This could be ANY width */
			height: 100%; /* This could be ANY height */
			background: #286090;
			z-index: 3000;
		}

		.inner-container {
			display: table-cell;
			vertical-align: middle;
			text-align: center;
		}

		.text-white {
			color: #fff;
		}

		.centered-content {
			display: inline-block;
			text-align: left;
			background: transparent;
			padding: 20px;
			border: 1px solid #5A738E;
			border-radius: 5px;
		}
	</style>
	<div class="outer-container" id="pageLoader">
		<div class="inner-container">
			<div class="centered-content">
				<div class="center text-white">
					<i class="fa fa-refresh fa-spin fa-4x fa-fw"></i>
					<h3 class="info-message"> Please wait while the page loads</h3>
				</div>
			</div>
		</div>
	</div>
	<link type="text/css" href="/assets/fonts/font-awesome/css/font-awesome.min.css" rel="stylesheet">        <!-- Font Awesome -->
	<link type="text/css" href="/assets/css/styles.css" rel="stylesheet">                                     <!-- Core CSS with all styles -->

	<link type="text/css" href="/assets/plugins/jstree/dist/themes/avenger/style.min.css" rel="stylesheet">    <!-- jsTree -->
	<link type="text/css" href="/assets/plugins/codeprettifier/prettify.css" rel="stylesheet">                <!-- Code Prettifier -->
	<link type="text/css" href="/assets/plugins/iCheck/skins/minimal/blue.css" rel="stylesheet">              <!-- iCheck -->
	<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries. Placeholdr.js enables the placeholder attribute -->
	<!--[if lt IE 9]>
		<link type="text/css" href="/assets/css/ie8.css" rel="stylesheet">
		<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/respond.js/1.1.0/respond.min.js"></script>
		<script type="text/javascript" src="/assets/plugins/charts-flot/excanvas.min.js"></script>
		<script type="text/javascript" src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<!-- The following CSS are included as plugins and can be removed if unused-->


</head>

<body class="infobar-offcanvas">

	<div class="panel panel-default" data-widget='{"draggable": "false"}'>
		<div class="panel-heading">
			<h2>Generate Assessment</h2>
			<div class="panel-ctrls"
				 data-actions-container=""
				 data-action-collapse='{"target": ".panel-body"}'
				 data-action-expand=''
				 data-action-colorpicker=''>
			</div>
		</div>
		<div class="panel-editbox" data-widget-controls=""></div>
		<div class="panel-body">


			<div class="form-horizontal">

				<div class="form-group col-md-4">
					<div class="col-md-10">
						<label class="control-label col-md-12">@Model.studentID</label>

					</div>
				</div>
				<div class="form-group col-md-4">
					<div class="col-md-12">
						<label class="control-label col-md-12">@Model.studentName</label>

					</div>
				</div>
				<div class="form-group col-md-4">
					<div class="col-md-12">
						<label class="control-label col-md-12">@Model.studentEmail</label>

					</div>
				</div>
				<div class="col-md-12">
					<div class="panel panel-default" data-widget='{"draggable": "false"}'>
						<div class="panel-heading">
							<h2>Choose Assessment Category</h2>
							<div class="panel-ctrls"
								 data-actions-container=""
								 data-action-collapse='{"target": ".panel-body"}'
								 data-action-expand=''
								 data-action-colorpicker=''>
							</div>
						</div>
						<div class="panel-editbox" data-widget-controls=""></div>
						<div class="panel-body">


							<div class="form-horizontal">
								<div class="form-group">
									<label class="col-sm-2 control-label">Category</label>
									<div class="col-md-10">
										<select class="form-control" id="inventorySelect"></select>
									</div>
								</div>
								<div class="form-group">
									<label class="col-sm-2 control-label">SubCategory</label>
									<div class="col-md-10">
										<select class="form-control" id="subInventorySelect"></select>
									</div>
								</div>
								<div class="form-group">
									<center>
										<input type="button" id="btnAddSubCat" class="btn btn-primary" value="Add SubCategory" />
									</center>

								</div>
								<div class="form-group">
									<label class="col-sm-2 control-label">selected SubCategory</label>
									<div class="col-md-10">
										<table id="tblSubCat" class="table table-bordered table-striped" style="margin-top: 50px; width: 50%;">
											<thead id="tblHeader">
											</thead>
										</table>
									</div>
								</div>



							</div>


						</div>
					</div>
				</div>


				<div class="panel-footer">
					<div class="row">
						<div class="col-sm-8 col-sm-offset-2">


							<div class="form-actions no-color">
								<input type="button" id="startAssessment" value="Start Assessment" class="btn btn-primary" />
							</div>

						</div>
					</div>
				</div>

			</div>



		</div>
	</div>
	<script type="text/javascript" src="/assets/js/jquery-1.10.2.min.js"></script> 							<!-- Load jQuery -->
	<script type="text/javascript" src="/assets/js/jqueryui-1.9.2.min.js"></script> 							<!-- Load jQueryUI -->

	<script type="text/javascript" src="/assets/js/bootstrap.min.js"></script> 								<!-- Load Bootstrap -->


	<script type="text/javascript" src="/assets/plugins/easypiechart/jquery.easypiechart.js"></script> 		<!-- EasyPieChart-->
	<script type="text/javascript" src="/assets/plugins/sparklines/jquery.sparklines.min.js"></script>  		<!-- Sparkline -->
	<script type="text/javascript" src="/assets/plugins/jstree/dist/jstree.min.js"></script>  				<!-- jsTree -->

	<script type="text/javascript" src="/assets/plugins/codeprettifier/prettify.js"></script> 				<!-- Code Prettifier  -->
	<script type="text/javascript" src="/assets/plugins/bootstrap-switch/bootstrap-switch.js"></script> 		<!-- Swith/Toggle Button -->

	<script type="text/javascript" src="/assets/plugins/bootstrap-tabdrop/js/bootstrap-tabdrop.js"></script>  <!-- Bootstrap Tabdrop -->

	<script type="text/javascript" src="/assets/plugins/iCheck/icheck.min.js"></script>     					<!-- iCheck -->

	<script type="text/javascript" src="/assets/js/enquire.min.js"></script> 									<!-- Enquire for Responsiveness -->

	<script type="text/javascript" src="/assets/plugins/bootbox/bootbox.js"></script>							<!-- Bootbox -->


	<script type="text/javascript" src="/assets/plugins/nanoScroller/js/jquery.nanoscroller.min.js"></script> <!-- nano scroller -->

	<script type="text/javascript" src="/assets/plugins/jquery-mousewheel/jquery.mousewheel.min.js"></script> 	<!-- Mousewheel support needed for jScrollPane -->

	<script type="text/javascript" src="/assets/js/application.js"></script>
	<script type="text/javascript" src="/assets/demo/demo-switcher.js"></script>

	<!-- End loading site level scripts -->
	<!-- Load page level scripts-->

	<script type="text/javascript" src="/assets/plugins/form-validation/jquery.validate.min.js"></script>  					<!-- Validate Plugin -->
	<script type="text/javascript" src="/assets/plugins/form-stepy/jquery.stepy.js"></script>  								<!-- Stepy Plugin -->

	<script type="text/javascript" src="/assets/demo/demo-formwizard.js"></script>

	<!-- End loading page level scripts-->
	<script>
		(function () {
			$("#pageLoader").fadeOut(2000);
		})();
	</script>
	<script type="text/javascript">
		var count = 0;
		var totalSelected = 0;
	$(function () {
		var inventoryDDL = $("#inventorySelect");
		var subInventoryDDl = $("#subInventorySelect");;
		$.ajax({
			url: '/api/InventoryAPI',
			method: 'GET',
			dataType: 'JSON',
			contentType: "application/json; charset=utf-8;",
			success: function (data) {
			   // $("#inventoryData").html("");
				inventoryDDL.append($('<option></option>').val(-1).html('Select Category'));
				subInventoryDDl.append($('<option></option>').val(-1).html('Select SubCategory'));
				subInventoryDDl.prop('disabled',true);
				$.each(data, function (index, item) {
					inventoryDDL.append(
						$('<option></option>').val(item.InventoryID).html(item.name));
				});
			},
			error: function (x, status, error) {
				alert(error);
			}
		})

		inventoryDDL.change(function () {
			if ($(this).val() == "-1") {
				subInventoryDDl.empty();
				subInventoryDDl.append($('<option></option>').val(-1).html('Select SubCategory'));
				subInventoryDDl.val(-1)
				subInventoryDDl.prop('disabled', true);
			}
			else
			{
				$.ajax({
					url: '/api/SubInventoryAPI',
					data: { id: $(this).val() },
					method: 'GET',
					dataType: 'JSON',
					contentType: "application/json; charset=utf-8;",
					success: function (data) {
						// $("#inventoryData").html("");
						subInventoryDDl.empty();
						subInventoryDDl.append($('<option></option>').val(-1).html('Select SubCategory'));
						subInventoryDDl.prop('disabled', false);
						$.each(data, function (index, item) {
							subInventoryDDl.append(
								$('<option></option>').val(item.SubInventoryID).html(item.name));
						});
					},
					error: function (x, status, error) {
						alert(error);
					}
				})

			}
		});








		//$("#QuestionText").change(function(){

		//    removeValidation("#QuestionText")
		//});

		//$("#AnswerText").change(function(){

		//    removeValidation("#AnswerText")
		//});



		$("#btnAddSubCat").click(function () {
			if (totalSelected > 5) {
				return false;

			}
			totalSelected++;
			var seclectedSubCat = $("#subInventorySelect").val();;

			var isExist = false;
			if (seclectedSubCat > 0) {
				$(document).ready(function () {
					$('table tr').each(function () {
						if ($(this).find('td').eq(0).text() == seclectedSubCat) {
							isExist = true;
							return false;
						}
					});
				});
				if (isExist) {
					return false;
				}

				if (count < 1)
				{
					var strhtmlhead = '<tr class="head">';
					strhtmlhead += '<th>SubCategory Name</th><th>Delete</th></tr>';
					count = count + 1;
					$("#tblHeader").append(strhtmlhead);

				}
				var strHtml = '';

				strHtml += '<tr class="answer">';
				strHtml += '<td style="display: none" class="answer-id">' + $("#subInventorySelect").val() + '</td>';
				strHtml += '<td class="answer-text">' + $("#subInventorySelect option:selected").text() + '</td>';


				strHtml += '<td class="answer-delete">';
				strHtml += '<input type="button" id="btnDeleteSubCat" class="btn btn-primary delete-SubCat" value="Delete" />';
				strHtml += '</td>';
				strHtml += '</tr>';

				$("#tblSubCat").append(strHtml);

				$("#AnswerText").val("");

				$(".delete-SubCat").click(function () {
					$(this).parent().parent().remove();
				});


			}
			else {

			}
		});

		$("#startAssessment").click(function () {
			if (totalSelected<3) {
				alert("you need to select at least 3 SubCategory");
				return false;
			}
			var selectedSubInventory = "";
			$(document).ready(function () {
				$('table tr').each(function () {
					selectedSubInventory =selectedSubInventory+ $(this).find('td').eq(0).text() + ',';
				});
			});
			$.post('/SetSession/SetVariable',
		   { key: "selectedSubInventory", value: selectedSubInventory }, function (data) {
			  
		   });

			url = "/Exam/StartExam";
			$(location).attr("href", url);
			
		});

		$("#btnSave").click(function() {
			if ($("#QuestionText").val() != "" && $("#subInventorySelect").val() > 0) {

				var question = {};
				var answers = [];


				question.QuestionText = $("#QuestionText").val();
				question.SubInventoryID = $("#subInventorySelect").val();

				if ($('.answer').length==0) {

					return;
				} else {
					$('.answer').each(function () {
						var answer = {};
						answer.AnswerText = $(this).find('.answer-text').text();

						answers.push(answer);
					});
				}

				question.Answers = answers;
				var data= {
					question:question
				}


				$.ajax({
					url: '@Url.Action("Add","Questions")',
					type: "POST",
					dataType: 'json',
					data: JSON.stringify(data),
					contentType: "application/json; charset=utf-8;",
					success: function(data) {
						alert("success");
					}
				});


			} else {
				alert("Please Add Question Text");
			}
		});
	});
	</script>
</body>
</html>
